{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>SIT TO FIT</title>
        {% tailwind_css %}
        <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
            import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-messaging.js";
            
            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyCmKxJerDOJc8hoQ7FrkA42RmjTwAg5B78",
                authDomain: "sit-to-fit-40890.firebaseapp.com",
                projectId: "sit-to-fit-40890",
                storageBucket: "sit-to-fit-40890.firebasestorage.app",
                messagingSenderId: "267449225965",
                appId: "1:267449225965:web:490cb8dcb99a97fdbdb2e4",
                measurementId: "G-YLTQJ1ZXPJ"
              };
        
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
        
            // Initialize Messaging
            const messaging = getMessaging(app);
        
            // ขออนุญาตการแจ้งเตือนจาก browser
            Notification.requestPermission().then(permission => {
              if (permission === 'granted') {
                // ดึง Token
                // หมายเหตุ: ในเวอร์ชั่นใหม่ คุณจำเป็นต้องกำหนด VAPID KEY (web push certificate key pair)
                getToken(messaging, { vapidKey: 'BI9plwhZBp338eYi4gCsMUmh4YbpRh1xrFWCelnU7C0bEx5a4cw4x7jdKrxmqRZbNDTL_42md5mlrGBzBqX5z0k' }).then((currentToken) => {
                  if (currentToken) {
                    console.log("FCM Token:", currentToken);
                    // ส่ง token นี้ไปเก็บในฐานข้อมูลหรือ server ของคุณ
                    saveTokenToServer(currentToken); 
                  } else {
                    console.log('No registration token available.');
                  }
                }).catch((err) => {
                  console.error('An error occurred while retrieving token.', err);
                });
              } else {
                console.log('Permission not granted for notifications');
              }
            });
            function saveTokenToServer(token) {
              fetch('/save-fcm-token/', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                      'Authorization': 'Bearer ' + localStorage.getItem('user_token') // ถ้าจำเป็นต้องใช้ token สำหรับ authentication
                  },
                  body: JSON.stringify({ token: token })
              })
              .then(response => response.json())
              .then(data => {
                  console.log('Token saved successfully:', data);
              })
              .catch(error => {
                  console.error('Error saving token:', error);
              });
          }
        </script>
        <script>
            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.register('/static/firebase-messaging-sw.js')
                .then(function(registration) {
                  console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(function(error) {
                  console.log('Service Worker registration failed:', error);
                });
            }
          </script>
        

    </head>

<body class="flex min-h-screen bg-orange-100 overflow-auto">
        <aside class="w-64 bg-white shadow-lg">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-green-600">SIT TO FIT</h1>
            </div>
            <nav class="mt-6">
                <ul>
                    <li class="py-2 px-4 hover:bg-green-100">
                        <a href={% url 'Dashboard:dashboard_home' %} class="flex items-center text-gray-700">
                            <i class="fas fa-home mr-3"></i>Dashboard
                        </a>
                    </li>
                    <li class="py-2 px-4 hover:bg-green-100">
                        <a href="#" class="flex items-center text-gray-700">
                            <i class="fas fa-book mr-3"></i>Instruction
                        </a>
                    </li>
                    <li class="py-2 px-4 hover:bg-green-100">
                        <a href={% url 'Notification:notification' %} class="flex items-center text-gray-700">
                            <i class="fas fa-bell mr-3"></i>Notification
                        </a>
                    </li>
                    <li class="py-2 px-4 hover:bg-green-100">
                        <a href={% url 'camera:DetectHub' %} class="flex items-center text-gray-700">
                            <i class="fas fa-user mr-3"></i>Detection
                        </a>
                    </li>
                    <li class="py-2 px-4 hover:bg-green-100">
                        <a href={% url 'base:home'%} class="flex items-center text-gray-700">
                            <i class="fas fa-cog mr-3"></i>Account
                        </a>
                    </li>
                    <li>
                        <hr class='my-4'>
                        <ul>
                            <li class="py-2 px-4 hover:bg-green-100">
                                <form method="post" action="{% url 'base:logout' %}">
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-500">Logout</button>
                                </form>
    
                            </li>
                        </ul>
                    </li>
                </ul>
            
        
            </nav>
        </aside>

        <main class=" flex-1 p-6 overflow-auto">
            {% block main %}

            {% endblock %}
        </main>
</body>
</html>
